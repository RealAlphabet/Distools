!function(){"use strict";function e(e){return new Promise(s=>setTimeout(s,e))}const s={getByProps(...e){return this.getModule(s=>e.every(e=>s[e]))},getByValue(e,s){return this.getModule(t=>t[e]==s,!0)},getModule(e,s=!1){let t=this.getModules();for(let r in t){let{exports:n}=t[r];if(n){if(n.__esModule&&n.default&&e(n.default))return s?n:n.default;if(e(n))return n}}},getModules(){let e="webpackmodules";return this._require||(this._require="function"==typeof window.webpackJsonp?window.webpackJsonp([],{[e]:(e,s,t)=>s.default=t},[e]).default:window.webpackJsonp.push([[],{[e]:(e,s,t)=>e.exports=t},[[e]]]).c,delete this._require[e]),this._require}},t=(s.getByProps("createElement","cloneElement"),s.getByProps("render","findDOMNode"),s.getByProps("getAPIBaseURL")),r=s.getByProps("Permissions","ActivityTypes","StatusTypes"),n=s.getByProps("getCurrentUser"),a=(s.getByProps("getToken"),s.getByProps("getMember")),i=s.getByProps("getChannels"),l=s.getByProps("getMessages"),d=s.getByProps("getLastSelectedGuildId"),o=s.getByProps("getLastSelectedChannelId"),h=s.getByProps("getUsers"),g=s.getByProps("receiveMessage","sendBotMessage");var u={async searchSharedFriends(s){let n=Object.values(this.users),a=[];for(let s of n)s.relationships?a.push(Promise.resolve(s)):(a.push(t.get(r.Endpoints.USER_RELATIONSHIPS(s.id)).then(({text:e})=>(s.relationships=JSON.parse(e),s))),await e(20));return Promise.all(a).then(e=>e.filter(({relationships:e})=>e.find(({id:e})=>e===s)))},fetchAllMembers(){console.log(r.Endpoints)},searchGuildMessages(e=this.selectedGuildId,s=this.user.id,n=0){return new Promise(a=>{t.get(r.Endpoints.SEARCH_GUILD(e)+`?author_id=${s}&include_nsfw=true&offset=${n}`).then(e=>e.body).catch(t=>{setTimeout(()=>a(this.searchGuildMessages(e,s,n)),1e3*t.body.retry_after)})})},searchChannelMessages(e=this.selectedChannelId,s=this.user.id,n=0){return new Promise(a=>{t.get(r.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${s}&offset=${n}`).then(e=>a(e.body)).catch(t=>{setTimeout(()=>a(this.searchChannelMessages(e,s,n)),1e3*t.body.retry_after)})})},async searchAllMessages(e,s,t,r=!0){let n,a=[],i=0;for(;(n=await e.call(this,s,t,i)).messages.length&&(a.push(...n.messages),i+=n.messages.length,!(a.length>=1500)););return r?a.map(e=>e.find(e=>e.hit)):a},searchAllGuildMessages(e=this.selectedGuildId,s=this.user.id,t=!0){return this.searchAllMessages(this.searchGuildMessages,e,s,t)},searchAllChannelMessages(e=this.selectedChannelId,s=this.user.id,t=!0){return this.searchAllMessages(this.searchChannelMessages,e,s,t)},deleteMessage(e,s){return new Promise(n=>{t.delete(r.Endpoints.MESSAGES(e)+"/"+s).then(n).catch(t=>{setTimeout(()=>n(this.deleteMessage(e,s)),1e3*t.body.retry_after)})})},async deleteSearchMessages(s,t,r){let n=await this.searchAllMessages(s,t,r),a=0;this.progressBar.setSteps(n.length);for(let s of n)this.progressBar.setProgress(++a),console.log(`[DISTOOLS][ðŸ—‘ï¸] ${a} / ${n.length} messages.`),0==s.type&&(await this.deleteMessage(s.channel_id,s.id),await e(150));console.log("Done."),await e(2e3),this.progressBar.setProgress(0)},deleteGuildMessages(e=this.selectedGuildId,s=this.user.id){return this.deleteSearchMessages(this.searchGuildMessages,e,s)},deleteChannelMessages(e=this.selectedChannelId,s=this.user.id){return this.deleteSearchMessages(this.searchChannelMessages,e,s)},async fetchAllMessages(e=this.selectedChannelId){let s=this.messages.reverse(),n=[];do{n.push(...s),s=(await t.get({url:r.Endpoints.MESSAGES(e),query:{before:s[s.length-1].id,limit:100}})).body}while(s.length>0);return n.reverse()},saveMessages(){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),this.fetchAllMessages().then(e=>{const s=this.members.map(e=>({id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar}));s.push(this.user),this.downloadTextFile(e[0].channel_id+".json",JSON.stringify({members:s,messages:e.map(e=>({id:e.id,author:e.author.id,content:e.content,timestamp:e.timestamp}))},null,2))})},downloadTextFile(e,s){let t=window.URL.createObjectURL(new Blob([s],{type:"octet/stream"})),r=document.createElement("a");r.href=t,r.download=e,r.style.display="none",document.body.prepend(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)},get receiveMessages(){return g},get members(){return this.SelectedGuildId?a.getMembers(this.selectedGuildId):i.getChannel(this.selectedChannelId).rawRecipients},get users(){return h.getUsers()},get selectedGuildId(){return d.getGuildId()},get selectedChannelId(){return o.getChannelId()},get selectedChannel(){return i.getChannel(this.selectedChannelId)},get messages(){return l.getMessages(this.selectedChannelId).toArray()},get user(){return n.getCurrentUser()}};u.progressBar=new Proxy({},{get:()=>()=>{}}),window.DISTOOLS=u}();
