!function(){"use strict";function e(e){return new Promise(s=>setTimeout(s,e))}const s={getByProps(...e){return this.getModule(s=>e.every(e=>s[e]))},getByValue(e,s){return this.getModule(t=>t[e]==s,!0)},getModule(e,s=!1){let t=this.getModules();for(let r in t){let{exports:n}=t[r];if(n){if(n.__esModule&&n.default&&e(n.default))return s?n:n.default;if(e(n))return n}}},getModules(){let e="webpackmodules";return this._require||(this._require="function"==typeof window.webpackJsonp?window.webpackJsonp([],{[e]:(e,s,t)=>s.default=t},[e]).default:window.webpackJsonp.push([[],{[e]:(e,s,t)=>e.exports=t},[[e]]]).c,delete this._require[e]),this._require}},t=(s.getByProps("createElement","cloneElement"),s.getByProps("render","findDOMNode"),s.getByProps("getAPIBaseURL")),r=s.getByProps("Permissions","ActivityTypes","StatusTypes"),n=s.getByProps("getCurrentUser"),i=(s.getByProps("getToken"),s.getByProps("getMember")),l=s.getByProps("getChannel"),a=(s.getByProps("getChannels"),s.getByProps("getMessages")),h=s.getByProps("getLastSelectedGuildId"),d=s.getByProps("getLastSelectedChannelId"),o=s.getByProps("getUsers");s.getByProps("receiveMessage","sendBotMessage");var g={fetchRetry(e,s){return new Promise((t,r)=>{e(s).then(e=>t(e.body)).catch(n=>{429==n.statusCode?setTimeout(()=>t(this.fetchRetry(e,s)),1e3*n.body.retry_after):r(n)})})},fetchRelationships(e){return this.fetchRetry(t.get,r.Endpoints.USER_RELATIONSHIPS(e))},fetchAllMembers(){console.log(r.Endpoints)},async searchSharedFriends(s){let t=Object.values(this.users),r=[];for(let s of t)s.relationships?r.push(Promise.resolve(s)):(r.push(this.fetchRelationships(s.id).then(e=>(s.relationships=e,s))),await e(25));return Promise.all(r).then(e=>e.filter(({relationships:e})=>e.find(({id:e})=>e===s)))},searchGuildMessages(e=this.selectedGuildId,s=this.user.id,n=0){return this.fetchRetry(t.get,r.Endpoints.SEARCH_GUILD(e)+`?author_id=${s}&include_nsfw=true&offset=${n}`)},searchChannelMessages(e=this.selectedChannelId,s=this.user.id,n=0){return this.fetchRetry(t.get,r.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${s}&offset=${n}`)},async searchAllMessages(e,s,t,r=!0){let n,i=[],l=0;for(;(n=await e(s,t,l)).messages.length&&(i.push(...n.messages),l+=n.messages.length,!(i.length>=1500)););return r?i.map(e=>e.find(e=>e.hit)):i},searchAllGuildMessages(e=this.selectedGuildId,s=this.user.id,t=!0){return this.searchAllMessages(this.searchGuildMessages,e,s,t)},searchAllChannelMessages(e=this.selectedChannelId,s=this.user.id,t=!0){return this.searchAllMessages(this.searchChannelMessages,e,s,t)},deleteMessage(e,s){return this.fetchRetry(t.delete,r.Endpoints.MESSAGES(e)+"/"+s)},async deleteSearchMessages(s,t,r){let n=await this.searchAllMessages(s,t,r),i=0;this.progressBar.setSteps(n.length);for(let s of n)this.progressBar.setProgress(++i),console.log(`[DISTOOLS][ðŸ—‘ï¸] ${i} / ${n.length} messages.`),0!=s.type&&19!=s.type||(await this.deleteMessage(s.channel_id,s.id),await e(150));console.log("Done."),await e(2e3),this.progressBar.setProgress(0)},deleteGuildMessages(e=this.selectedGuildId,s=this.user.id){return this.deleteSearchMessages(this.searchGuildMessages,e,s)},deleteChannelMessages(e=this.selectedChannelId,s=this.user.id){return this.deleteSearchMessages(this.searchChannelMessages,e,s)},async fetchAllMessages(e=this.selectedChannelId){let s=this.messages.reverse(),n=[];do{n.push(...s),s=(await t.get({url:r.Endpoints.MESSAGES(e),query:{before:s[s.length-1].id,limit:100}})).body}while(s.length>0);return n.reverse()},saveMessages(e=this.selectedChannelId){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),this.fetchAllMessages(e).then(s=>{const t=new Map;s=s.map(e=>(t.set(e.author.id,e.author),(e={...e}).author=e.author.id,delete e.channel_id,e)),this.downloadTextFile(s[0].channel_id+".json",JSON.stringify({channel:e,users:[...t.values()],messages:s}))})},downloadTextFile(e,s){let t=window.URL.createObjectURL(new Blob([s],{type:"octet/stream"})),r=document.createElement("a");r.href=t,r.download=e,r.style.display="none",document.body.prepend(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(t)},get members(){return this.selectedGuildId?i.getMembers(this.selectedGuildId):l.getChannel(this.selectedChannelId).rawRecipients},get users(){return o.getUsers()},get selectedGuildId(){return h.getGuildId()},get selectedChannelId(){return d.getChannelId()},get selectedChannel(){return l.getChannel(this.selectedChannelId)},get messages(){return a.getMessages(this.selectedChannelId).toArray()},get user(){return n.getCurrentUser()}};g.progressBar=new Proxy({},{get:()=>()=>{}}),window.DISTOOLS=g}();
