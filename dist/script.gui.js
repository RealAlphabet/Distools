!function(){"use strict";function e(e){return new Promise((t=>setTimeout(t,e)))}function t(e,s){return new Promise(((n,r)=>{e(s).then((e=>n(e.body))).catch((l=>{429==l.status?setTimeout((()=>t(e,s).then(n)),1e3*l.body.retry_after):r(l)}))}))}const s={getByProps(...e){return this.getModule((t=>e.every((e=>t[e]))))},getByValue(e,t){return this.getModule((s=>s[e]==t),!0)},getModule(e,t=!1){let s=this.getModules();for(let n in s){let{exports:r}=s[n];if(r){if(r.__esModule&&r.default&&e(r.default))return t?r:r.default;if(e(r))return r}}},getModules(){return this._require||(window.webpackChunkdiscord_app.push([["webpackmodules"],{},e=>this._require=e.c]),delete this._require.webpackmodules),this._require}},n=s.getByProps("Inflate").Inflate,r=s.getByProps("getErlpackEncoding").getErlpackEncoding(),l=s.getByProps("createElement","cloneElement"),a=s.getByProps("render","findDOMNode"),i=s.getByProps("getAPIBaseURL"),o=s.getByProps("Permissions","ActivityTypes","StatusTypes");s.getByProps("getToken");const d=s.getByProps("getCurrentUser");s.getByProps("receiveMessage","sendBotMessage");const c=s.getByProps("getMember"),u=s.getByProps("getChannel");s.getByProps("getChannels");const g=s.getByProps("getMessages"),h=s.getByProps("getLastSelectedGuildId"),p=s.getByProps("getLastSelectedChannelId"),m=s.getByProps("getUsers"),f=s.getByProps("getActivityMetadata").getState();function y(){const e=Promise.all([new Promise((e=>{const t=WebSocket.prototype.send;WebSocket.prototype.send=function(){return this.url.includes("gateway.discord.gg")&&(WebSocket.prototype.send=t,e(this)),t.apply(this,arguments)}})),new Promise((e=>{const t=n.prototype.push;n.prototype.push=function(){return n.prototype.push=t,e(this),t.apply(this,arguments)}}))]);return e.then((([e,t])=>{let s=r?new r:{pack:JSON.stringify,unpack:e=>e},n=t.onEnd;return{ws:e,setSpotifyStatus(e={}){this.send({op:3,d:{status:"dnd",since:0,activities:[{type:2,name:"Spotify",assets:{large_image:`spotify:${e.image}`,large_text:e.title},details:e.title,state:e.authors,timestamps:{start:Date.now(),end:Date.now()+864e5},party:{id:"spotify:"},sync_id:null,flags:48,metadata:{album_id:null,artist_ids:[]}}],afk:!1}})},setVoiceState(e={}){this.send({op:4,d:{guild_id:e.guild??DISTOOLS.selectedGuildId,channel_id:e.channel??DISTOOLS.selectedChannelId,self_mute:mute??!1,self_deaf:deaf??!1,self_video:video??!1}})},fetchGuildMembers(){for(let e=0;e<5e3;e+=100)this.send({op:14,d:{guild_id:DISTOOLS.selectedGuildId,channels:{[DISTOOLS.selectedChannelId]:[[0,99],[e,e-1]]}}})},send(t){e.send(s.pack(t))},receive(e){n=t.onEnd,t.onEnd=function(){return this.chunks.map((t=>{e(s.unpack(t))})),n.apply(this,arguments)}},stop(){t.onEnd=n}}}))}const S={hijack(){y().then((e=>{window.Trampoline=e,console.log("HIJACKED.")}))},fetchRelationships:e=>t(i.get,o.Endpoints.USER_RELATIONSHIPS(e)),async searchSharedFriends(t){let s=Object.values(S.users),n=[];for(let t of s)t.relationships?n.push(Promise.resolve(t)):(n.push(S.fetchRelationships(t.id).then((e=>(t.relationships=e,t)))),await e(20));return Promise.all(n).then((e=>e.filter((({relationships:e})=>e.find((({id:e})=>e===t))))))},getUserActivities(e){let t=f.clientStatuses[e];return t&&{id:e,activities:f.activities[e],status:t}},searchGuildMessages:(e=S.selectedGuildId,s=S.user.id,n=0)=>t(i.get,o.Endpoints.SEARCH_GUILD(e)+`?author_id=${s}&include_nsfw=true&offset=${n}`),searchChannelMessages:(e=S.selectedChannelId,s=S.user.id,n=0)=>t(i.get,o.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${s}&offset=${n}`),async searchAllMessages(e,t,s,n=!0){let r,l=[],a=0;for(;(r=await e(t,s,a)).messages.length&&(l.push(...r.messages),a+=r.messages.length,!(l.length>=1500)););return n?l.map((e=>e.find((e=>e.hit)))):l},searchAllGuildMessages:(e=S.selectedGuildId,t=S.user.id,s=!0)=>S.searchAllMessages(S.searchGuildMessages,e,t,s),searchAllChannelMessages:(e=S.selectedChannelId,t=S.user.id,s=!0)=>S.searchAllMessages(S.searchChannelMessages,e,t,s),deleteMessage:(e,s)=>t(i.delete,o.Endpoints.MESSAGES(e)+"/"+s),async deleteSearchMessages(t,s,n){let r=await S.searchAllMessages(t,s,n),l=0;S.progressBar.setSteps(r.length);for(let t of r)S.progressBar.setProgress(++l),console.log(`[DISTOOLS][üóëÔ∏è] ${l} / ${r.length} messages.`),0!=t.type&&19!=t.type||(await S.deleteMessage(t.channel_id,t.id),await e(150));console.log("Done."),await e(2e3),S.progressBar.setProgress(0)},deleteGuildMessages:(e=S.selectedGuildId,t=S.user.id)=>S.deleteSearchMessages(S.searchGuildMessages,e,t),deleteChannelMessages:(e=S.selectedChannelId,t=S.user.id)=>S.deleteSearchMessages(S.searchChannelMessages,e,t),async fetchAllMessages(e=S.selectedChannelId){let s=[],n=[];do{n.push(...s),s=await t(i.get,{url:o.Endpoints.MESSAGES(e),query:{before:s.length?s[s.length-1].id:null,limit:100}})}while(s.length>0);return n.reverse()},saveMessages(e=S.selectedChannelId){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),S.fetchAllMessages(e).then((t=>{const s=new Map;t=t.map((e=>(s.set(e.author.id,e.author),(e={...e}).author=e.author.id,delete e.channel_id,e))),function(e,t){let s=window.URL.createObjectURL(new Blob([t],{type:"octet/stream"})),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",n.click(),window.URL.revokeObjectURL(s)}(`${e}.json`,JSON.stringify({channel:e,users:[...s.values()],messages:t}))}))},get members(){return S.selectedGuildId?c.getMembers(S.selectedGuildId):u.getChannel(S.selectedChannelId).rawRecipients},get users(){return m.getUsers()},get selectedGuildId(){return h.getGuildId()},get selectedChannelId(){return p.getChannelId()},get selectedChannel(){return u.getChannel(S.selectedChannelId)},get messages(){return g.getMessages(S.selectedChannelId).toArray()},get user(){return d.getCurrentUser()}};class E extends l.Component{constructor(e){super(e),this.node=l.createRef()}componentDidUpdate(){this.node.current&&window.requestAnimationFrame((()=>{var e=this.node.current.style;e.transform="translate(-50%, -50%) scale(1)",e.opacity="1"}))}render(){return this.props.hide?null:l.createElement("div",{class:"modal",style:{opacity:0},ref:this.node},l.createElement("form",{class:"settings"},l.createElement("label",null,l.createElement("input",{type:"radio",value:"guild",checked:"true"}),"Current Guild"),l.createElement("label",null,l.createElement("input",{type:"radio",value:"channel"}),"Current Channel")))}}class w extends l.Component{constructor(e){super(e),this.progressBar=l.createRef(),this.steps=100}setSteps(e){this.steps=e}setProgress(e){this.progressBar.current.style.width=e/this.steps*100+"%"}render(){return l.createElement("div",{class:"progress-bar"},l.createElement("div",{class:"progress",ref:this.progressBar}))}}class M extends l.Component{constructor(e){super(e),this.state={hideSettings:!0},this.progressBar=l.createRef()}componentDidMount(){S.progressBar=this.progressBar.current}render(){return l.createElement(l.Fragment,null,l.createElement("style",null,"#distools * {\n    box-sizing: border-box;\n}\n\n#distools .right {\n    margin-left: auto;\n}\n\n#distools>nav {\n    background-color: #191818;\n    position: fixed;\n    left: 0;\n    bottom: 0;\n    display: flex;\n    height: 48px;\n    width: 100%;\n    padding: 0 4.5rem;\n    font-size: 0.85rem;\n    color: #fff;\n}\n\n#distools>nav>* {\n    display: flex;\n    align-items: center;\n}\n\n#distools>nav>.title {\n    margin-right: 1.5rem;\n    font-weight: bold;\n}\n\n#distools>nav>ul>li {\n    transition: background-color ease-in-out .2s;\n    display: flex;\n    align-items: center;\n    height: 100%;\n    padding: 0 1rem;\n    cursor: pointer;\n}\n\n#distools>nav>ul>li:hover {\n    background-color: #000;\n}\n\n/* PROGRESS BAR */\n.progress-bar {\n    background-color: #36393f;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    height: 2px;\n}\n\n.progress {\n    transition: width ease-in-out .8s;\n    background-color: #2e70f3;\n    width: 0;\n    height: 2px;\n}\n\n/* MODAL */\n.modal {\n    transition: ease-in-out .25s;\n    transition-property: transform, opacity;\n    transform: translate(-50%, -50%) scale(0.8);\n    opacity: 0;\n    background-color: #191818;\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    width: 500px;\n    height: 500px;\n    z-index: 1;\n    color: #fff;\n}"),l.createElement(E,{hide:this.state.hideSettings}),l.createElement("nav",null,l.createElement(w,{ref:this.progressBar}),l.createElement("div",{class:"title"},"DISTOOLS"),l.createElement("ul",null,l.createElement("li",{onClick:()=>S.deleteGuildMessages()},"üóëÔ∏è Delete guild messages"),l.createElement("li",{onClick:()=>S.deleteChannelMessages()},"üóëÔ∏è Delete channel messages"),l.createElement("li",{onClick:()=>S.saveMessages()},"üíæ Save messages")),l.createElement("ul",{class:"right"},l.createElement("li",{onClick:()=>this.setState({hideSettings:!this.state.hideSettings})},"‚öôÔ∏è Settings"))))}}document.getElementById("app-mount").style.height="calc(100vh - 48px)";var C=document.getElementById("distools");C&&C.remove(),(C=document.createElement("div")).id="distools",a.render(l.createElement(M,null),C),document.body.prepend(C),window.DISTOOLS=S}();
