!function(){"use strict";class e{static byProps(e,t=(e=>e)){return s=>{if(!s)return!1;if("object"!=typeof s&&"function"!=typeof s)return!1;const n=t(s);if(!n)return!1;for(let t=0;t<e.length;t++)if(!(e[t]in n))return!1;return!0}}static byPrototypeFields(e,t=(e=>e)){return s=>{if(!s)return!1;if("object"!=typeof s&&"function"!=typeof s)return!1;const n=t(s);if(!n)return!1;if(!n.prototype)return!1;for(let t=0;t<e.length;t++)if(!(e[t]in n.prototype))return!1;return!0}}static byRegex(e,t=(e=>e)){return s=>{const n=t(s);if(!n)return!1;let r="";try{r=n.toString([])}catch(e){r=n.toString()}return-1!==r.search(e)}}static byStrings(...e){return t=>{if(!t?.toString||"function"!=typeof t?.toString)return;let s="";try{s=t?.toString([])}catch(e){s=t?.toString()}if(!s)return!1;for(const t of e)if(!s.includes(t))return!1;return!0}}static byDisplayName(e){return t=>t&&t.displayName===e}static combine(...e){return t=>e.every((e=>e(t)))}}const t=new WeakSet,s=e=>(s,n,r)=>{try{return!(s?.default?.remove&&s?.default?.set&&s?.default?.clear&&s?.default?.get&&!s?.default?.sort)&&(!(s.remove&&s.set&&s.clear&&s.get&&!s.sort)&&(!(s?.default?.getToken||s?.default?.getEmail||s?.default?.showToken)&&(!(s.getToken||s.getEmail||s.showToken)&&e(s,n,r))))}catch(s){return t.has(e)||Logger.warn("WebpackModules~getModule","Module filter threw an exception.",e,s),t.add(e),!1}};class n{static find(e,t=!0){return this.getModule(e,{first:t})}static findAll(e){return this.getModule(e,{first:!1})}static findByUniqueProperties(e,t=!0){return t?this.getByProps(...e):this.getAllByProps(...e)}static findByDisplayName(e){return this.getByDisplayName(e)}static getModule(e,t={}){const{first:n=!0,defaultExport:r=!0,searchExports:i=!1}=t,o=s(e),l=this.getAllModules(),a=[],d=Object.keys(l);for(let e=0;e<d.length;e++){const t=d[e];if(!l.hasOwnProperty(t))continue;const s=l[t],{exports:c}=s;if(c&&c!==window&&c!==document.documentElement)if("object"==typeof c&&i)for(const e in c){let r=null;const i=c[e];if(i&&(o(i,s,t)&&(r=i),r)){if(n)return r;a.push(r)}}else{let e=null;if(c.Z&&o(c.Z,s,t)&&(e=r?c.Z:c),c.ZP&&o(c.ZP,s,t)&&(e=r?c.ZP:c),c.__esModule&&c.default&&o(c.default,s,t)&&(e=r?c.default:c),o(c,s,t)&&(e=c),!e)continue;if(n)return e;a.push(e)}}return n||0==a.length?void 0:a}static getBulk(...e){const t=this.getAllModules(),n=Array(e.length),r=Object.keys(t);for(let i=0;i<r.length;i++){const o=r[i];if(!t.hasOwnProperty(o))continue;const l=t[o],{exports:a}=l;if(a&&a!==window&&a!==document.documentElement)for(let t=0;t<e.length;t++){const r=e[t],{filter:i,first:d=!0,defaultExport:c=!0,searchExports:u=!1}=r;if(d&&n[t])continue;d||n[t]||(n[t]=[]);const h=s(i);if("object"==typeof a&&u)for(const e in a){let s=null;const r=a[e];r&&(h(r,l,o)&&(s=r),s&&(d?n[t]=s:n[t].push(s)))}else{let e=null;if(a.Z&&h(a.Z,l,o)&&(e=c?a.Z:a),a.ZP&&h(a.ZP,l,o)&&(e=c?a.ZP:a),a.__esModule&&a.default&&h(a.default,l,o)&&(e=c?a.default:a),h(a,l,o)&&(e=a),!e)continue;d?n[t]=e:n[t].push(e)}}}return n}static getModules(e){return this.getModule(e,{first:!1})}static getByDisplayName(t){return this.getModule(e.byDisplayName(t))}static getByRegex(t,s=!0){return this.getModule(e.byRegex(t),{first:s})}static getByPrototypes(...t){return this.getModule(e.byPrototypeFields(t))}static getAllByPrototypes(...t){return this.getModule(e.byPrototypeFields(t),{first:!1})}static getByProps(...t){return this.getModule(e.byProps(t))}static getAllByProps(...t){return this.getModule(e.byProps(t),{first:!1})}static getByString(...t){return this.getModule(e.byStrings(...t))}static getAllByString(...t){return this.getModule(e.byStrings(...t),{first:!1})}static getLazy(e,t={}){const{signal:n,defaultExport:r=!0,searchExports:i=!1}=t,o=this.getModule(e,{defaultExport:r,searchExports:i});if(o)return Promise.resolve(o);const l=s(e);return new Promise((e=>{const t=()=>this.removeListener(s),s=function(s){if(!s||s===window||s===document.documentElement)return;let n=null;if("object"==typeof s&&i)for(const e in s){n=null;const t=s[e];t&&(l(t)&&(n=t))}else s.Z&&l(s.Z)&&(n=r?s.Z:s),s.ZP&&l(s.ZP)&&(n=r?s.ZP:s),s.__esModule&&s.default&&l(s.default)&&(n=r?s.default:s),l(s)&&(n=s);n&&(t(),e(n))};this.addListener(s),n?.addEventListener("abort",(()=>{t(),e()}))}))}static get require(){if(this._require)return this._require;const e="bd-webpackmodules";let t;return"undefined"!=typeof webpackJsonp?t=window.webpackJsonp.push([[],{[e]:(e,t,s)=>e.exports=s},[[e]]]):void 0!==window[this.chunkName]&&window[this.chunkName].push([[e],{},e=>t=e]),delete t.m[e],delete t.c[e],this._require=t}static getAllModules(){return this.require.c}static get chunkName(){return"webpackChunkdiscord_app"}static initialize(){this.handlePush=this.handlePush.bind(this),this.listeners=new Set,this.__ORIGINAL_PUSH__=window[this.chunkName].push,Object.defineProperty(window[this.chunkName],"push",{configurable:!0,get:()=>this.handlePush,set:e=>{this.__ORIGINAL_PUSH__=e,Object.defineProperty(window[this.chunkName],"push",{value:this.handlePush,configurable:!0,writable:!0})}})}static addListener(e){return this.listeners.add(e),this.removeListener.bind(this,e)}static removeListener(e){return this.listeners.delete(e)}static handlePush(e){const[,t]=e;for(const e in t){const s=t[e];t[e]=(e,t,n)=>{try{Reflect.apply(s,null,[e,t,n]);const r=[...this.listeners];for(let e=0;e<r.length;e++)try{r[e](t)}catch(e){Logger.stacktrace("WebpackModules","Could not fire callback listener:",e)}}catch(e){Logger.stacktrace("WebpackModules","Could not patch pushed module",e)}},Object.assign(t[e],s,{toString:()=>s.toString()})}return Reflect.apply(this.__ORIGINAL_PUSH__,window[this.chunkName],[e])}}function r(e){return new Promise((t=>setTimeout(t,e)))}function i(e,t){return new Promise(((s,n)=>{e(t).then((e=>s(e.body))).catch((r=>{429==r.status?setTimeout((()=>i(e,t).then(s)),1e3*r.body.retry_after):n(r)}))}))}n.initialize();const o=n.getByProps("Inflate").Inflate,l=n.getByProps("createElement","cloneElement"),a=n.getByProps("render","findDOMNode"),d=n.getByProps("getAPIBaseURL"),c=n.getByProps("Permissions","ActivityTypes","StatusTypes");n.getByProps("getToken");const u=n.getByProps("getCurrentUser");n.getByProps("receiveMessage","sendBotMessage");const h=n.getByProps("getMember"),g=n.getByProps("getChannel");n.getByProps("getChannels");const p=n.getByProps("getMessages"),f=n.getByProps("getLastSelectedGuildId"),y=n.getByProps("getLastSelectedChannelId"),m=n.getByProps("getUsers"),b=n.getByProps("getActivityMetadata").getState();function w(){const e=Promise.all([new Promise((e=>{const t=WebSocket.prototype.send;WebSocket.prototype.send=function(){return this.url.includes("gateway.discord.gg")&&(WebSocket.prototype.send=t,e(this)),t.apply(this,arguments)}})),new Promise((e=>{const t=o.prototype.push;o.prototype.push=function(){return o.prototype.push=t,e(this),t.apply(this,arguments)}}))]);return e.then((([e,t])=>{let s={pack:JSON.stringify,unpack:e=>e},n=t.onEnd;return{ws:e,setSpotifyStatus(e={}){this.send({op:3,d:{status:"dnd",since:0,activities:[{type:2,name:"Spotify",assets:{large_image:`spotify:${e.image}`,large_text:e.title},details:e.title,state:e.authors,timestamps:{start:Date.now(),end:Date.now()+864e5},party:{id:"spotify:"},sync_id:null,flags:48,metadata:{album_id:null,artist_ids:[]}}],afk:!1}})},setVoiceState(e={}){this.send({op:4,d:{guild_id:e.guild??DISTOOLS.selectedGuildId,channel_id:e.channel??DISTOOLS.selectedChannelId,self_mute:mute??!1,self_deaf:deaf??!1,self_video:video??!1}})},fetchGuildMembers(){for(let e=0;e<5e3;e+=100)this.send({op:14,d:{guild_id:DISTOOLS.selectedGuildId,channels:{[DISTOOLS.selectedChannelId]:[[0,99],[e,e-1]]}}})},send(t){e.send(s.pack(t))},receive(e){n=t.onEnd,t.onEnd=function(){return this.chunks.map((t=>{e(s.unpack(t))})),n.apply(this,arguments)}},stop(){t.onEnd=n}}}))}const S={hijack(){w().then((e=>{window.Trampoline=e,console.log("HIJACKED.")}))},fetchRelationships:e=>i(d.get,c.Endpoints.USER_RELATIONSHIPS(e)),async searchSharedFriends(e){let t=Object.values(S.users),s=[];for(let e of t)e.relationships?s.push(Promise.resolve(e)):(s.push(S.fetchRelationships(e.id).then((t=>(e.relationships=t,e)))),await r(20));return Promise.all(s).then((t=>t.filter((({relationships:t})=>t.find((({id:t})=>t===e))))))},getUserActivities(e){let t=b.clientStatuses[e];return t&&{id:e,activities:b.activities[e],status:t}},searchGuildMessages:(e=S.selectedGuildId,t=S.user.id,s=0)=>i(d.get,c.Endpoints.SEARCH_GUILD(e)+`?author_id=${t}&include_nsfw=true&offset=${s}`),searchChannelMessages:(e=S.selectedChannelId,t=S.user.id,s=0)=>i(d.get,c.Endpoints.SEARCH_CHANNEL(e)+`?author_id=${t}&offset=${s}`),async searchAllMessages(e,t,s,n=!0){let r,i=[],o=0;for(;(r=await e(t,s,o)).messages.length&&(i.push(...r.messages),o+=r.messages.length,!(i.length>=1500)););return n?i.map((e=>e.find((e=>e.hit)))):i},searchAllGuildMessages:(e=S.selectedGuildId,t=S.user.id,s=!0)=>S.searchAllMessages(S.searchGuildMessages,e,t,s),searchAllChannelMessages:(e=S.selectedChannelId,t=S.user.id,s=!0)=>S.searchAllMessages(S.searchChannelMessages,e,t,s),deleteMessage:(e,t)=>i(d.delete,c.Endpoints.MESSAGES(e)+"/"+t),async deleteSearchMessages(e,t,s){let n=await S.searchAllMessages(e,t,s),i=0;S.progressBar.setSteps(n.length);for(let e of n)S.progressBar.setProgress(++i),console.log(`[DISTOOLS][üóëÔ∏è] ${i} / ${n.length} messages.`),0!=e.type&&19!=e.type||(await S.deleteMessage(e.channel_id,e.id),await r(150));console.log("Done."),await r(2e3),S.progressBar.setProgress(0)},deleteGuildMessages:(e=S.selectedGuildId,t=S.user.id)=>S.deleteSearchMessages(S.searchGuildMessages,e,t),deleteChannelMessages:(e=S.selectedChannelId,t=S.user.id)=>S.deleteSearchMessages(S.searchChannelMessages,e,t),async fetchAllMessages(e=S.selectedChannelId){let t=[],s=[];do{s.push(...t),t=await i(d.get,{url:c.Endpoints.MESSAGES(e),query:{before:t.length?t[t.length-1].id:null,limit:100}})}while(t.length>0);return s.reverse()},saveMessages(e=S.selectedChannelId){alert("Starting downloading conversation.\nPlease do not click any buttons of the menu !"),S.fetchAllMessages(e).then((t=>{const s=new Map;t=t.map((e=>(s.set(e.author.id,e.author),(e={...e}).author=e.author.id,delete e.channel_id,e))),function(e,t){let s=window.URL.createObjectURL(new Blob([t],{type:"octet/stream"})),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",n.click(),window.URL.revokeObjectURL(s)}(`${e}.json`,JSON.stringify({channel:e,users:[...s.values()],messages:t}))}))},get members(){return S.selectedGuildId?h.getMembers(S.selectedGuildId):g.getChannel(S.selectedChannelId).rawRecipients},get users(){return m.getUsers()},get selectedGuildId(){return f.getGuildId()},get selectedChannelId(){return y.getChannelId()},get selectedChannel(){return g.getChannel(S.selectedChannelId)},get messages(){return p.getMessages(S.selectedChannelId).toArray()},get user(){return u.getCurrentUser()}};class P extends l.Component{constructor(e){super(e),this.node=l.createRef()}componentDidUpdate(){this.node.current&&window.requestAnimationFrame((()=>{var e=this.node.current.style;e.transform="translate(-50%, -50%) scale(1)",e.opacity="1"}))}render(){return this.props.hide?null:l.createElement("div",{class:"modal",style:{opacity:0},ref:this.node},l.createElement("form",{class:"settings"},l.createElement("label",null,l.createElement("input",{type:"radio",value:"guild",checked:"true"}),"Current Guild"),l.createElement("label",null,l.createElement("input",{type:"radio",value:"channel"}),"Current Channel")))}}class M extends l.Component{constructor(e){super(e),this.progressBar=l.createRef(),this.steps=100}setSteps(e){this.steps=e}setProgress(e){this.progressBar.current.style.width=e/this.steps*100+"%"}render(){return l.createElement("div",{class:"progress-bar"},l.createElement("div",{class:"progress",ref:this.progressBar}))}}class E extends l.Component{constructor(e){super(e),this.state={hideSettings:!0},this.progressBar=l.createRef()}componentDidMount(){S.progressBar=this.progressBar.current}render(){return l.createElement(l.Fragment,null,l.createElement("style",null,"#distools * {\n    box-sizing: border-box;\n}\n\n#distools .right {\n    margin-left: auto;\n}\n\n#distools>nav {\n    background-color: #191818;\n    position: fixed;\n    left: 0;\n    bottom: 0;\n    display: flex;\n    height: 48px;\n    width: 100%;\n    padding: 0 4.5rem;\n    font-size: 0.85rem;\n    color: #fff;\n}\n\n#distools>nav>* {\n    display: flex;\n    align-items: center;\n}\n\n#distools>nav>.title {\n    margin-right: 1.5rem;\n    font-weight: bold;\n}\n\n#distools>nav>ul>li {\n    transition: background-color ease-in-out .2s;\n    display: flex;\n    align-items: center;\n    height: 100%;\n    padding: 0 1rem;\n    cursor: pointer;\n}\n\n#distools>nav>ul>li:hover {\n    background-color: #000;\n}\n\n/* PROGRESS BAR */\n.progress-bar {\n    background-color: #36393f;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    height: 2px;\n}\n\n.progress {\n    transition: width ease-in-out .8s;\n    background-color: #2e70f3;\n    width: 0;\n    height: 2px;\n}\n\n/* MODAL */\n.modal {\n    transition: ease-in-out .25s;\n    transition-property: transform, opacity;\n    transform: translate(-50%, -50%) scale(0.8);\n    opacity: 0;\n    background-color: #191818;\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    width: 500px;\n    height: 500px;\n    z-index: 1;\n    color: #fff;\n}"),l.createElement(P,{hide:this.state.hideSettings}),l.createElement("nav",null,l.createElement(M,{ref:this.progressBar}),l.createElement("div",{class:"title"},"DISTOOLS"),l.createElement("ul",null,l.createElement("li",{onClick:()=>S.deleteGuildMessages()},"üóëÔ∏è Delete guild messages"),l.createElement("li",{onClick:()=>S.deleteChannelMessages()},"üóëÔ∏è Delete channel messages"),l.createElement("li",{onClick:()=>S.saveMessages()},"üíæ Save messages")),l.createElement("ul",{class:"right"},l.createElement("li",{onClick:()=>this.setState({hideSettings:!this.state.hideSettings})},"‚öôÔ∏è Settings"))))}}document.getElementById("app-mount").style.height="calc(100vh - 48px)";var k=document.getElementById("distools");k&&k.remove(),(k=document.createElement("div")).id="distools",a.render(l.createElement(E,null),k),document.body.prepend(k),window.DISTOOLS=S}();
